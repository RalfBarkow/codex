# Use the flake for reproducible tools
use flake

# Prefer per-user secret file (kept outside the repo)
KEY_FILE="$HOME/.secrets/open-ai-api-key.txt"
if [ -z "${OPENAI_API_KEY-}" ] && [ -f "$KEY_FILE" ]; then
    export OPENAI_API_KEY="$(tr -d ' \n\r\t' < "$KEY_FILE")"
fi

# Mirror to OPEN_API_KEY if you also use that name elsewhere
if [ -z "${OPEN_API_KEY-}" ] && [ -n "${OPENAI_API_KEY-}" ]; then
    export OPEN_API_KEY="$OPENAI_API_KEY"
fi

# Optional local overrides (never commit secrets)
has() { type "$1" >/dev/null 2>&1; }
if has dotenv_if_exists; then
    dotenv_if_exists .env
elif has direnv; then
    # Fallback: source .env if present
    [ -f .env ] && set -a && . ./.env && set +a
fi
